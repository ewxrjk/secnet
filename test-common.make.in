
include ../common.make

TESTSCRIPTS ?= $(shell echo $(srcdir)/t-*[0-9a-z])
TESTNAMES := $(patsubst t-%,%,$(notdir $(TESTSCRIPTS)))

DEPS += $(topdir)/test-common.tcl

TARGETS += check

all: $(TARGETS)

check-real: $(foreach t,$(TESTNAMES),d-$t/ok)

d-%/ok: $(srcdir)/t-% $(DEPS)
	@rm -rf d-$*; mkdir d-$*
	export STEST_BUILDDIR=$(topbuilddir); \
	cd $(topdir) && $(TESTDIR)/t-$* >$(topbuilddir)/$(TESTDIR)/d-$*/log 2>&1
	@printf "$* "
	@touch $@

clean:
	$(RM) -f *.o *.so
	$(RM) -rf tmp
	$(RM) -rf d-*
